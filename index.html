<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meqenet Learner & Management App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, addDoc, deleteDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Global Setup (Required Boilerplate) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // Note: The __firebase_config comes in as a string and needs parsing
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, db, auth;
        let userId = null;
        
        // State management (Simulated with a global object for simplicity)
        const appState = {
            view: 'lesson', // 'lesson', 'quiz', 'activity', 'manageLearners', 'settings'
            module: 'Literacy', // 'Literacy', 'Numeracy', 'SocialSkills', 'LifeSkills'
            textSize: 'medium', // 'small', 'medium', 'large'
            contrastMode: 'normal', // 'normal', 'high'
            learners: [], // List of managed learners
            isAuthReady: false,
            modules: ['Literacy', 'Numeracy', 'SocialSkills', 'LifeSkills']
        };

        // --- Phonics Data with Words and Emojis ---
        const PHONICS_DATA = [
            { letter: 'A', sound: 'ah', word: 'Apple', emoji: 'üçé' },
            { letter: 'B', sound: 'buh', word: 'Ball', emoji: '‚öΩ' },
            { letter: 'C', sound: 'kuh', word: 'Cat', emoji: 'üêà' },
            { letter: 'D', sound: 'duh', word: 'Dog', emoji: 'üêï' },
            { letter: 'E', sound: 'eh', word: 'Egg', emoji: 'ü•ö' },
            { letter: 'F', sound: 'fuh', word: 'Fish', emoji: 'üê†' },
            { letter: 'G', sound: 'guh', word: 'Goat', emoji: 'üêê' },
            { letter: 'H', sound: 'huh', word: 'House', emoji: 'üè†' },
            { letter: 'I', sound: 'ih', word: 'Igloo', emoji: 'üßä' },
            { letter: 'J', sound: 'juh', word: 'Jam', emoji: 'üçì' },
            { letter: 'K', sound: 'kuh', word: 'Key', emoji: 'üîë' },
            { letter: 'L', sound: 'luh', word: 'Lion', emoji: 'ü¶Å' },
            { letter: 'M', sound: 'muh', word: 'Moon', emoji: 'üåô' },
            { letter: 'N', sound: 'nuh', word: 'Nest', emoji: 'üê¶' },
            { letter: 'O', sound: 'oh', word: 'Octopus', emoji: 'üêô' },
            { letter: 'P', sound: 'puh', word: 'Pig', emoji: 'üêñ' },
            { letter: 'Q', sound: 'kwuh', word: 'Queen', emoji: 'üëë' },
            { letter: 'R', sound: 'ruh', word: 'Rabbit', emoji: 'üêá' },
            { letter: 'S', sound: 'suh', word: 'Sun', emoji: '‚òÄÔ∏è' },
            { letter: 'T', sound: 'tuh', word: 'Tree', emoji: 'üå≥' },
            { letter: 'U', sound: 'uh', word: 'Umbrella', emoji: '‚òî' },
            { letter: 'V', sound: 'vuh', word: 'Van', emoji: 'üöê' },
            { letter: 'W', sound: 'wuh', word: 'Water', emoji: 'üíß' },
            { letter: 'X', sound: 'ks', word: 'Xylophone', emoji: 'üéπ' },
            { letter: 'Y', sound: 'yuh', word: 'Yacht', emoji: '‚õµ' },
            { letter: 'Z', sound: 'zuh', word: 'Zebra', emoji: 'ü¶ì' },
        ];


        // --- Firebase Initialization and Auth ---
        window.initializeFirebase = async () => {
            if (!firebaseConfig) {
                console.error("Firebase config is missing. Running in non-data mode.");
                // Still allow UI to load even if firebase is missing
                userId = crypto.randomUUID(); 
                appState.isAuthReady = true;
                document.getElementById('user-id-display').textContent = userId;
                return;
            }
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('error'); // Only log errors to keep console clean

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        // console.log("User authenticated:", userId);
                    } else {
                        // Sign in anonymously if no token is available or initial state is null
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                    userId = auth.currentUser?.uid || crypto.randomUUID();
                    appState.isAuthReady = true;
                    document.getElementById('user-id-display').textContent = userId;
                    // Once authenticated, start listening for data
                    setupRealtimeListeners(); 
                });
            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
            }
        };

        // --- Firestore Data Paths ---
        const getLearnersCollectionPath = (uid) => `/artifacts/${appId}/users/${uid}/learners`;

        // --- Firestore Realtime Listeners ---
        function setupRealtimeListeners() {
            if (!db || !userId) return;

            // 1. Listen for Learners
            const learnersRef = collection(db, getLearnersCollectionPath(userId));
            onSnapshot(learnersRef, (snapshot) => {
                appState.learners = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderLearnersList();
                // console.log("Learners data updated.");
            }, (error) => {
                console.error("Error listening to learners:", error);
            });
        }

        // --- Text-to-Speech (TTS) Logic ---
        window.speak = function(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Attempt to find a smooth, clear female voice for a gentle tone.
                // Note: Specific voice names vary by browser/OS, so we look for keywords.
                const voices = speechSynthesis.getVoices();
                // Prioritize voices that include 'female' and 'english'
                const preferredVoice = voices.find(v => v.lang.startsWith('en') && v.name.includes('Female')) 
                                    || voices.find(v => v.lang.startsWith('en') && v.name.includes('Google US English')) 
                                    || voices.find(v => v.lang.startsWith('en')); // Fallback to any English voice

                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }

                utterance.lang = 'en-US';
                utterance.rate = 0.6; // Slower rate for clear, motherly/teaching tone
                utterance.pitch = 1.1; // Slightly higher pitch for clarity/gentleness
                
                speechSynthesis.cancel(); // Stop any current speaking
                speechSynthesis.speak(utterance);
            } else {
                console.warn("Text-to-Speech not supported in this browser.");
            }
        }
        
        window.handlePhonicsClick = function(letter, sound, word) {
            // 1. Give visual feedback
            window.showFeedback(`${letter} is for ${word}!`, 'info');
            
            // 2. Play Audio Feedback: Simply speak the letter and the word (e.g., "A, Apple.")
            const textToSpeak = `${letter}, ${word}.`; 
            window.speak(textToSpeak);
        }

        // --- View Logic ---
        window.changeView = function(newView) {
            appState.view = newView;
            // Ensure all view containers exist before attempting to hide/show
            document.getElementById('lesson-view')?.classList.add('hidden');
            document.getElementById('quiz-view')?.classList.add('hidden');
            document.getElementById('activity-view')?.classList.add('hidden');
            document.getElementById('manageLearners-view')?.classList.add('hidden');
            document.getElementById('settings-view')?.classList.add('hidden');

            const viewElement = document.getElementById(`${newView}-view`);
            if (viewElement) {
                viewElement.classList.remove('hidden');
                
                // Special actions for specific views
                if (newView === 'manageLearners') {
                    renderLearnersList();
                } else if (newView === 'lesson') {
                    loadModule(appState.module);
                }
            }
        };

        // --- Accessibility and Theme Logic ---
        window.applyTheme = function(mode) {
            appState.contrastMode = mode;
            const body = document.getElementById('app-body');
            
            // Check if body exists before accessing properties
            if (!body) return;

            // Reset classes
            body.className = 'min-h-screen ' + (mode === 'high' ? 'bg-black text-yellow-300' : 'bg-gray-50 text-gray-900');
            
            // Re-apply styles to cards globally
            document.querySelectorAll('.section-card').forEach(el => {
                if (mode === 'high') {
                    el.classList.remove('bg-white', 'text-gray-900');
                    el.classList.add('bg-gray-900', 'text-yellow-300', 'border-yellow-300');
                } else {
                    el.classList.add('bg-white', 'text-gray-900');
                    el.classList.remove('bg-gray-900', 'text-yellow-300', 'border-yellow-300');
                }
            });

            document.getElementById('contrast-mode-label').textContent = mode === 'high' ? 'High Contrast (On)' : 'Normal Contrast (Off)';
        };

        window.applyTextSize = function(size) {
            appState.textSize = size;
            const sizeMap = {
                'small': 'text-base',
                'medium': 'text-xl',
                'large': 'text-3xl'
            };
            const contentArea = document.getElementById('content-area');
            if (contentArea) {
                 contentArea.className = `p-4 flex-grow ${sizeMap[size]}`;
            }
            document.getElementById('text-size-label').textContent = size.charAt(0).toUpperCase() + size.slice(1);
        };

        // --- Module Content Logic (ENHANCED FOR SEN) ---

        function getContent(moduleName) {
            switch (moduleName) {
                case 'Literacy':
                    return `
                        <h2 class="text-4xl font-extrabold mb-6 text-indigo-700">Phonics & Sight Words</h2>
                        <p class="mb-4">Tap a tile to hear the letter and the corresponding word. Multisensory learning helps us remember!</p>
                        <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4 mt-6">
                            ${PHONICS_DATA.map(item => 
                                `<button 
                                    class="large-touch-target bg-indigo-500 hover:bg-indigo-600 text-white p-4 flex flex-col items-center justify-center space-y-2"
                                    onclick="window.handlePhonicsClick('${item.letter}', '${item.sound}', '${item.word}')"
                                >
                                    <span class="text-6xl font-black">${item.letter}</span>
                                    <span class="text-5xl">${item.emoji}</span>
                                    <span class="text-xl font-bold">${item.word}</span>
                                </button>`
                            ).join('')}
                        </div>
                    `;
                case 'Numeracy':
                    return `
                        <h2 class="text-4xl font-extrabold mb-6 text-green-700">1 - 100 Counting & Matching</h2>
                        <p class="mb-4">Practice counting forwards and backwards. Use manipulatives (physical objects) to match the number displayed on the screen.</p>
                        <div class="grid grid-cols-5 sm:grid-cols-7 md:grid-cols-10 gap-2 mt-6">
                            ${Array.from({length: 20}, (_, i) => i + 1).map(n => 
                                `<button class="large-touch-target bg-green-500 hover:bg-green-600 text-white text-3xl">${n}</button>`
                            ).join('')}
                            <div class="col-span-full mt-4 text-center text-2xl font-semibold text-gray-600">...and more numbers!</div>
                        </div>
                    `;
                case 'SocialSkills':
                    return renderSocialSkillsContent();
                case 'LifeSkills':
                    return renderLifeSkillsContent();
                default:
                    return `<p class="text-red-500">Module content not found.</p>`;
            }
        }

        function renderSocialSkillsContent() {
            const emotions = [
                { name: 'Happy', emoji: 'üòä', color: 'yellow' },
                { name: 'Sad', emoji: 'üò¢', color: 'blue' },
                { name: 'Angry', emoji: 'üò°', color: 'red' },
                { name: 'Calm', emoji: 'üòå', color: 'green' }
            ];

            return `
                <h2 class="text-4xl font-extrabold mb-6 text-purple-700">Understanding Feelings</h2>
                <p class="mb-6">Look at the face and say how the person feels. Try to make the same face in the mirror!</p>
                <div class="grid grid-cols-2 gap-6 mt-6 max-w-2xl mx-auto">
                    ${emotions.map(e => `
                        <div class="section-card flex flex-col items-center p-6 bg-white border-4 border-gray-200 shadow-xl">
                            <span class="text-8xl">${e.emoji}</span>
                            <button 
                                class="mt-4 large-touch-target w-full bg-${e.color}-500 hover:bg-${e.color}-600 text-white text-3xl"
                                onclick="window.showFeedback('Great job! ${e.name}!', 'success')"
                            >
                                ${e.name}
                            </button>
                        </div>
                    `).join('')}
                </div>
                <div id="quiz-message" class="mt-4 text-center text-xl font-bold"></div>
            `;
        }
        
        function renderLifeSkillsContent() {
            const steps = [
                { text: '1. Turn on the water and wet your hands.', icon: 'üíß' },
                { text: '2. Get some soap.', icon: 'üßº' },
                { text: '3. Rub your hands together: front, back, and between fingers.', icon: 'üëè' },
                { text: '4. Rinse your hands with clean water.', icon: 'üöø' },
                { text: '5. Dry your hands with a clean towel.', icon: '‚úÖ' }
            ];

            return `
                <h2 class="text-4xl font-extrabold mb-6 text-orange-700">Life Skill: Washing Hands</h2>
                <p class="mb-6">This is a social story. Follow the steps in order to learn how to wash your hands. Say the steps out loud!</p>
                <div class="flex flex-col space-y-4 max-w-3xl mx-auto">
                    ${steps.map((step, index) => `
                        <div class="section-card flex items-center p-4 bg-white border-l-8 border-orange-500 shadow-md">
                            <span class="text-4xl mr-4">${step.icon}</span>
                            <span class="font-semibold text-2xl">${step.text}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="mt-8 text-center">
                    <button 
                        class="large-touch-target bg-orange-500 hover:bg-orange-600 text-white text-3xl px-8"
                        onclick="window.showFeedback('Try to do this after every time you use the bathroom or before you eat!', 'info')"
                    >
                        Practice Now
                    </button>
                </div>
            `;
        }

        window.loadModule = function(moduleName) {
            appState.module = moduleName;
            document.getElementById('module-title').textContent = moduleName;
            
            const contentAreaMain = document.getElementById('content-area-main');
            if (contentAreaMain) {
                 contentAreaMain.innerHTML = getContent(moduleName);
            }

            // Update module buttons active state
            const buttons = document.querySelectorAll('.module-button');
            buttons.forEach(btn => {
                if (btn.dataset.module === moduleName) {
                    btn.classList.add('bg-indigo-600', 'text-white');
                    btn.classList.remove('bg-gray-200', 'text-gray-700');
                } else {
                    btn.classList.remove('bg-indigo-600', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                }
            });
        };
        
        // General feedback mechanism for activities
        window.showFeedback = function(message, type) {
            const quizMessage = document.getElementById('quiz-message');
            // Use the main feedback area if 'quiz-message' isn't available in this view
            const feedbackEl = quizMessage || document.getElementById('main-feedback'); 
            
            if (!feedbackEl) return; 
            
            feedbackEl.textContent = message;
            
            if (type === 'success') {
                feedbackEl.className = 'mt-4 text-center text-3xl font-bold text-green-600';
            } else if (type === 'error') {
                feedbackEl.className = 'mt-4 text-center text-3xl font-bold text-red-600';
            } else { // info
                feedbackEl.className = 'mt-4 text-center text-3xl font-bold text-blue-600';
            }

            // Clear message after 3 seconds
            setTimeout(() => {
                feedbackEl.textContent = '';
                // Reset to a neutral class
                feedbackEl.className = 'mt-4 text-center text-xl font-bold'; 
            }, 3000);
        }

        // --- Learner Management Logic (Simplified for brevity, core functions remain) ---
        
        function renderLearnersList() {
            const list = document.getElementById('learners-list');
            if (!list) return; // Exit if element is not in the current view

            if (!appState.isAuthReady) {
                 list.innerHTML = `<p class="text-xl text-center text-blue-500">Loading learners...</p>`;
                 return;
            }

            if (appState.learners.length === 0) {
                list.innerHTML = `<p class="text-xl text-center text-gray-500">No learners registered yet. Use the form above to add one!</p>`;
                return;
            }

            list.innerHTML = appState.learners.map(learner => `
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200 mb-2">
                    <div class="flex-grow">
                        <p class="text-2xl font-semibold">${learner.name}</p>
                        <p class="text-lg text-gray-600">ID: <span class="font-mono text-sm bg-gray-200 p-1 rounded">${learner.id.substring(0, 8)}...</span></p>
                        <p class="text-lg text-gray-600">Focus: ${learner.focus || 'N/A'}</p>
                    </div>
                    <button 
                        onclick="window.deleteLearner('${learner.id}', '${learner.name}')" 
                        class="p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition duration-150"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M14 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"></path></svg>
                    </button>
                </div>
            `).join('');
        }

        window.deleteLearner = async function(learnerId, name) {
            // Using a custom modal UI for confirmation
            const modal = document.getElementById('custom-modal');
            const modalMessage = document.getElementById('modal-message');
            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');
            
            modalMessage.textContent = `Are you sure you want to delete the learner '${name}'? This cannot be undone.`;
            modal.classList.remove('hidden');

            const handleConfirm = async () => {
                modal.classList.add('hidden');
                modalMessage.textContent = '';
                // Important: Remove listeners to prevent multiple executions
                confirmBtn.removeEventListener('click', handleConfirm);
                cancelBtn.removeEventListener('click', handleCancel);

                try {
                    if (!db || !userId) throw new Error("Database or user not ready.");
                    const docRef = doc(db, getLearnersCollectionPath(userId), learnerId);
                    await deleteDoc(docRef);
                    showFormFeedback(`‚úÖ Learner '${name}' deleted successfully!`, 'success');
                } catch (error) {
                    console.error("Error deleting learner:", error);
                    showFormFeedback(`‚ùå Failed to delete learner: ${error.message}`, 'error');
                }
            };

            const handleCancel = () => {
                modal.classList.add('hidden');
                modalMessage.textContent = '';
                // Important: Remove listeners to prevent multiple executions
                confirmBtn.removeEventListener('click', handleConfirm);
                cancelBtn.removeEventListener('click', handleCancel);
                showFormFeedback('Deletion cancelled.', 'info');
            };

            // Re-attach listeners for the specific action
            confirmBtn.addEventListener('click', handleConfirm);
            cancelBtn.addEventListener('click', handleCancel);
        };

        window.addLearner = async function(event) {
            event.preventDefault();
            if (!db || !userId) {
                showFormFeedback("‚ùå System not ready. Try again in a moment.", 'error');
                return;
            }

            const form = document.getElementById('add-learner-form');
            const name = form.learnerName.value.trim();
            const dob = form.learnerDOB.value;
            const focus = form.learnerFocus.value.trim();
            
            if (!name || !focus) {
                showFormFeedback("Name and Focus Area are required.", 'error');
                return;
            }

            try {
                const learnersRef = collection(db, getLearnersCollectionPath(userId));
                const newLearner = {
                    name: name,
                    dob: dob || null,
                    focus: focus,
                    createdAt: new Date().toISOString()
                };

                const docRef = await addDoc(learnersRef, newLearner);
                showFormFeedback(`‚úÖ Learner registered! ID: ${docRef.id.substring(0, 5)}...`, 'success');
                document.getElementById('add-learner-form').reset();
            } catch (error) {
                console.error("Error adding new learner:", error);
                showFormFeedback("‚ùå Failed to register learner. Check console for details.", 'error');
            }
        };

        function showFormFeedback(message, type) {
            const formMessageEl = document.getElementById('learner-form-message');
            formMessageEl.textContent = message;
            
            if (type === 'success') {
                formMessageEl.className = 'mt-4 text-center font-semibold text-green-600';
            } else if (type === 'error') {
                formMessageEl.className = 'mt-4 text-center font-semibold text-red-600';
            } else { // info
                formMessageEl.className = 'mt-4 text-center font-semibold text-blue-600';
            }

            setTimeout(() => {
                formMessageEl.textContent = '';
                formMessageEl.className = 'mt-4 text-center font-semibold';
            }, 5000);
        }
        
        // --- Custom Modal Logic (for delete confirmation) ---
        window.closeModal = function() {
            document.getElementById('custom-modal').classList.add('hidden');
        }


        // Initial setup on load
        window.onload = function() {
            try {
                // 1. Initialize Firebase (async, but starts here)
                window.initializeFirebase(); 
                
                // 2. Apply initial visual settings
                applyTheme(appState.contrastMode);
                applyTextSize(appState.textSize);
                
                // 3. Load the default module content and view
                loadModule(appState.module); 
                changeView('lesson');

            } catch (error) {
                console.error("Fatal error during app initialization:", error);
                // Display a user-friendly error message if possible
                document.getElementById('content-area-main').innerHTML = `
                    <div class="text-center text-red-600 text-3xl p-10">
                        An error occurred while starting the app. Please check the console for details.
                    </div>
                `;
            }
        };

    </script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            transition: background-color 0.3s, color 0.3s; 
            /* Disable selection for touch apps */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        .large-touch-target {
            padding: 1rem;
            border-radius: 0.75rem;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            cursor: pointer;
        }
        .section-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }
        /* Mobile Navigation Styling */
        @media (max-width: 640px) {
            .nav-button-text {
                display: none;
            }
        }
        /* Custom size for the multisensory letter tiles */
        #content-area-main .large-touch-target {
            min-height: 180px;
        }
    </style>
</head>
<body id="app-body" class="bg-gray-50 text-gray-900 min-h-screen">

    <!-- Custom Confirmation Modal (Replaces alert/confirm) -->
    <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full">
            <h3 class="text-2xl font-bold mb-4 text-red-600">Confirm Action</h3>
            <p id="modal-message" class="text-xl mb-6 text-gray-700"></p>
            <div class="flex justify-end space-x-4">
                <button id="modal-cancel-btn" onclick="window.closeModal()" class="px-6 py-3 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition">Cancel</button>
                <button id="modal-confirm-btn" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">Confirm</button>
            </div>
        </div>
    </div>
    
    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header and Controls -->
        <header class="flex flex-col sm:flex-row justify-between items-center mb-6 section-card bg-white p-4">
            <h1 class="text-5xl font-extrabold text-indigo-700 mb-4 sm:mb-0">Meqenet Learner</h1>
            <nav class="flex space-x-2 text-xl">
                <button onclick="window.changeView('lesson')" class="p-3 rounded-xl bg-indigo-500 hover:bg-indigo-600 text-white font-semibold transition">Lessons</button>
                <button onclick="window.changeView('manageLearners')" class="p-3 rounded-xl bg-purple-500 hover:bg-purple-600 text-white font-semibold transition">Manage Learners</button>
                <button onclick="window.changeView('settings')" class="p-3 rounded-xl bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold transition">Settings</button>
            </nav>
        </header>

        <!-- Main Content Area -->
        <main class="grid grid-cols-1 lg:grid-cols-4 gap-6">

            <!-- Sidebar: Module Selection -->
            <aside class="lg:col-span-1 section-card p-4">
                <h2 class="text-3xl font-bold mb-4 text-gray-700"></h2>
                <div class="flex flex-col space-y-3" id="module-selection">
                    <!-- Buttons for Modules -->
                  
                        <button 
                            class="module-button large-touch-target text-2xl w-full text-left bg-gray-200 text-gray-700 hover:bg-gray-300 transition"
                            data-module="${module}"
                            onclick="window.load  ' $1').trim()}
                        </button>
                    `).join('')}
                </div>
            </aside>

            <!-- Content Panel -->
            <section id="content-panel" class="lg:col-span-3 section-card">

                <!-- Lesson/Quiz/Activity View -->
                <div id="lesson-view">
                    <h2 id="module-title" class="text-5xl font-black mb-6 text-center text-indigo-800">Literacy</h2>
                    <div id="content-area" class="p-4 flex-grow text-xl">
                        <div id="content-area-main" class="section-card p-8 bg-gray-50 min-h-[50vh] flex flex-col justify-center">
                            <!-- Content generated by getContent(appState.module) will load here -->
                        </div>
                    </div>
                </div>

                <!-- Main Feedback Area (Used by showFeedback for Lesson View) -->
                <div id="main-feedback" class="mt-4 text-center text-xl font-bold"></div>

                <!-- Quiz View (Hidden by default) -->
                <div id="quiz-view" class="hidden">
                    <h2 class="text-4xl font-extrabold mb-6 text-red-600">Quiz Corner</h2>
                    <div class="section-card p-8 bg-red-50 min-h-[50vh] flex flex-col justify-center items-center">
                        <p class="text-3xl text-red-800 font-medium">Coming Soon: Interactive Quizzes!</p>
                        <p class="text-xl text-red-600 mt-4">For now, use the Lesson View for content.</p>
                    </div>
                </div>

                <!-- Activity View (Hidden by default) -->
                <div id="activity-view" class="hidden">
                    <h2 class="text-4xl font-extrabold mb-6 text-yellow-600">Hands-On Activity</h2>
                    <div class="section-card p-8 bg-yellow-50 min-h-[50vh] flex flex-col justify-center items-center">
                        <p class="text-3xl text-yellow-800 font-medium">Coming Soon: Games & Interactive Activities!</p>
                        <p class="text-xl text-yellow-600 mt-4">For now, focus on the content in the Lesson View.</p>
                    </div>
                </div>

                <!-- Manage Learners View (Hidden by default) -->
                <div id="manageLearners-view" class="hidden">
                    <h2 class="text-4xl font-extrabold mb-6 text-purple-700">Learner Management</h2>
                    
                    <div class="mb-8 section-card p-6 bg-purple-50">
                        <h3 class="text-3xl font-bold mb-4 text-purple-800">Register New Learner</h3>
                        <form id="add-learner-form" onsubmit="window.addLearner(event)" class="space-y-4">
                            <input type="text" name="learnerName" placeholder="Learner Full Name (Required)" required 
                                class="w-full p-3 border-2 border-purple-300 rounded-lg text-xl focus:ring-2 focus:ring-purple-500">
                            <input type="date" name="learnerDOB" placeholder="Date of Birth (Optional)" 
                                class="w-full p-3 border-2 border-purple-300 rounded-lg text-xl focus:ring-2 focus:ring-purple-500">
                            <textarea name="learnerFocus" placeholder="Primary Focus Area (e.g., Autism, Down Syndrome, Communication) (Required)" required
                                class="w-full p-3 border-2 border-purple-300 rounded-lg text-xl h-24 focus:ring-2 focus:ring-purple-500"></textarea>
                            
                            <button type="submit" class="large-touch-target w-full bg-purple-600 hover:bg-purple-700 text-white text-2xl">
                                Register Learner
                            </button>
                        </form>
                        <div id="learner-form-message" class="mt-4 text-center font-semibold text-xl"></div>
                    </div>

                    <div class="mt-8">
                        <h3 class="text-3xl font-bold mb-4 text-purple-800">Registered Learners</h3>
                        <div id="learners-list" class="space-y-4">
                            <p class="text-xl text-center text-blue-500">Loading learners...</p>
                        </div>
                    </div>
                </div>

                <!-- Settings View (Hidden by default) -->
                <div id="settings-view" class="hidden">
                    <h2 class="text-4xl font-extrabold mb-6 text-gray-700">Accessibility Settings</h2>
                    
                    <div class="section-card mb-6">
                        <h3 class="text-3xl font-bold mb-4 text-gray-800">Contrast Mode</h3>
                        <div class="flex space-x-4">
                            <button onclick="window.applyTheme('normal')" class="large-touch-target bg-gray-300 hover:bg-gray-400 text-gray-800 text-2xl">Normal</button>
                            <button onclick="window.applyTheme('high')" class="large-touch-target bg-black hover:bg-gray-800 text-yellow-300 text-2xl">High Contrast</button>
                        </div>
                        <p id="contrast-mode-label" class="mt-4 text-xl font-medium">Normal Contrast (Off)</p>
                    </div>

                    <div class="section-card">
                        <h3 class="text-3xl font-bold mb-4 text-gray-800">Text Size</h3>
                        <div class="flex space-x-4">
                            <button onclick="window.applyTextSize('small')" class="large-touch-target bg-blue-500 hover:bg-blue-600 text-white text-xl">A Small</button>
                            <button onclick="window.applyTextSize('medium')" class="large-touch-target bg-blue-500 hover:bg-blue-600 text-white text-3xl">A Medium</button>
                            <button onclick="window.applyTextSize('large')" class="large-touch-target bg-blue-500 hover:bg-blue-600 text-white text-5xl">A Large</button>
                        </div>
                        <p id="text-size-label" class="mt-4 text-xl font-medium">Medium</p>
                    </div>

                    <div class="mt-8 section-card p-6 bg-gray-100">
                        <h3 class="text-3xl font-bold mb-4 text-gray-800">App Info</h3>
                        <p class="text-xl text-gray-700">User ID: <span id="user-id-display" class="font-mono bg-gray-200 p-1 rounded">Loading...</span></p>
                    </div>

                </div>
                
            </section>

        </main>
    </div>

</body>
</html>
